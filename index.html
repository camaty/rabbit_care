<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ウサギ健康チェック</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ウサギ健康チェック">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <h1>🐰 ウサギ健康チェック</h1>
        </header>

        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="home">ホーム</button>
            <button class="tab-btn" data-tab="weight">体重</button>
            <button class="tab-btn" data-tab="photos">写真</button>
            <button class="tab-btn" data-tab="settings">設定</button>
        </nav>

        <main class="app-main">
            <!-- Home Tab -->
            <div id="home" class="tab-content active">
                <div class="welcome-section">
                    <h2>今日のウサギの様子</h2>
                    <div class="quick-actions">
                        <button class="action-btn" onclick="openTab('weight')">
                            <span class="icon">⚖️</span>
                            体重記録
                        </button>
                        <button class="action-btn" onclick="openTab('photos')">
                            <span class="icon">📸</span>
                            写真撮影
                        </button>
                        <button class="action-btn" onclick="openHealthCheck()">
                            <span class="icon">🔍</span>
                            健康チェック
                        </button>
                    </div>
                </div>

                <div class="recent-records">
                    <h3>最近の記録</h3>
                    <div id="recent-entries"></div>
                </div>
            </div>

            <!-- Weight Tab -->
            <div id="weight" class="tab-content">
                <div class="weight-section">
                    <h2>体重記録</h2>
                    <div class="weight-input">
                        <label for="weight-value">体重 (g)</label>
                        <input type="number" id="weight-value" placeholder="例: 1500" step="1">
                        <button onclick="saveWeight()">記録</button>
                    </div>
                    <div class="weight-chart">
                        <canvas id="weight-chart-canvas"></canvas>
                    </div>
                    <div class="weight-history">
                        <h3>体重履歴</h3>
                        <div id="weight-list"></div>
                    </div>
                </div>
            </div>

            <!-- Photos Tab -->
            <div id="photos" class="tab-content">
                <div class="photos-section">
                    <h2>写真記録</h2>
                    <div class="photo-types">
                        <button class="photo-type-btn" onclick="selectPhotoType('fur')">
                            <span class="icon">🐰</span>
                            毛並み
                        </button>
                        <button class="photo-type-btn" onclick="selectPhotoType('poop')">
                            <span class="icon">💩</span>
                            うんち
                        </button>
                    </div>
                    
                    <div class="photo-upload">
                        <input type="file" id="photo-input" accept="image/*" capture="environment" style="display: none;">
                        <button id="photo-upload-btn" onclick="uploadPhoto()">写真を撮る</button>
                        <div id="photo-type-display"></div>
                    </div>

                    <div class="photo-gallery">
                        <h3>写真ギャラリー</h3>
                        <div class="photo-filter">
                            <button class="filter-btn active" onclick="filterPhotos('all')">すべて</button>
                            <button class="filter-btn" onclick="filterPhotos('fur')">毛並み</button>
                            <button class="filter-btn" onclick="filterPhotos('poop')">うんち</button>
                        </div>
                        <div id="photo-gallery-grid"></div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="settings-section">
                    <h2>設定</h2>
                    
                    <div class="setting-group">
                        <h3>ウサギ情報</h3>
                        <div class="setting-item">
                            <label for="rabbit-name">名前</label>
                            <input type="text" id="rabbit-name" placeholder="ウサギの名前">
                        </div>
                        <div class="setting-item">
                            <label for="rabbit-breed">品種</label>
                            <input type="text" id="rabbit-breed" placeholder="例: ネザーランドドワーフ">
                        </div>
                        <div class="setting-item">
                            <label for="rabbit-birthday">誕生日</label>
                            <input type="date" id="rabbit-birthday">
                        </div>
                    </div>

                    <div class="setting-group">
                        <h3>ChatGPT設定</h3>
                        <div class="setting-item">
                            <label for="openai-api-key">OpenAI API Key</label>
                            <input type="password" id="openai-api-key" placeholder="sk-...">
                            <small>健康チェック機能を使用するにはOpenAI APIキーが必要です</small>
                        </div>
                        <button onclick="testApiKey()">接続テスト</button>
                    </div>

                    <div class="setting-group">
                        <h3>データ管理</h3>
                        <button onclick="exportData()">データをエクスポート</button>
                        <button onclick="importData()">データをインポート</button>
                        <button onclick="clearAllData()" class="danger-btn">すべてのデータを削除</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Health Check Modal -->
        <div id="health-check-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>健康チェック</h2>
                    <button class="close-btn" onclick="closeHealthCheck()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="health-check-form">
                        <h3>分析したい項目を選択してください</h3>
                        <div class="health-check-options">
                            <label>
                                <input type="checkbox" id="check-weight"> 体重の変化
                            </label>
                            <label>
                                <input type="checkbox" id="check-fur"> 毛並みの状態
                            </label>
                            <label>
                                <input type="checkbox" id="check-poop"> うんちの状態
                            </label>
                        </div>
                        <textarea id="health-question" placeholder="気になることがあれば詳しく記入してください..."></textarea>
                        <button onclick="performHealthCheck()">健康チェック開始</button>
                    </div>
                    <div id="health-check-result" style="display: none;">
                        <h3>分析結果</h3>
                        <div id="health-analysis"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>